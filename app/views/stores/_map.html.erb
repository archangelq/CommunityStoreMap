<%content_for :head do %>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #store_map { height: 500px; width: 500px; }
</style>

<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript">

  var test_stores = <%= raw @stores.to_json %>;
  function initialize() {
    var latlng = new google.maps.LatLng(<%= "#{@center[0]},#{@center[1]}" %>);
    var myOptions = {
      zoom: 8,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var ne = new google.maps.LatLng(<%= @bounds[:ne].join(",") %>)
    var sw = new google.maps.LatLng(<%= @bounds[:sw].join(",") %>)
    var bounds = new google.maps.LatLngBounds(sw, ne);
    var map = new google.maps.Map(document.getElementById("store_map"),
        myOptions);
        //map.fitBounds(bounds);
        var stores = <%= raw @stores.to_json %>;
        markersSetup(map, stores);
  }
  
  function markersSetup(map, stores)
  {
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0; i < stores.length; i++) {
      var store = stores[i].store;
      var myLatLng = new google.maps.LatLng(store.lat, store.lng);
      var marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        title: store.name,
        zIndex: 1
      });
    bounds.extend(myLatLng);
    map.fitBounds(bounds);
    }
  }

$(document).ready(initialize)
</script>
<% end %>


<div id="store_map" style="width:500px; height:500px;">
&nbsp;
</div>